# Gas 优化概述

## gas 优化技巧并非总是有效

某些 gas 优化技巧只在特定情况下有效。例如，直观上，以下代码：

```
if (!cond) {
    // branch False
}
else {
    // branch True
}
```

比以下代码效率更低

```
if (cond) {
    // branch True
}
else {
    // branch False
}
```

因为在条件取反时会消耗额外的操作码。令人意外的是，有很多情况下，这种优化实际上会增加交易的成本。Solidity 编译器有时是不可预测的。

因此，在选择特定算法之前，你应该实际测量替代方案的效果。考虑这些技巧可以认识到编译器一些可能会让人惊讶的地方。

本文档中一些技巧会被标记为非通用。Gas 优化技巧有时取决于编译器在本地的操作。通常应同时测试代码的最优版本和非最优版本，以查看是否真正获得了改进。我们将记录一些令人惊讶的情况，即本应导致优化的情况实际上导致了更高的成本。

其次，当使用 Solidity 编译器的 `--via-ir` 选项时，某些优化行为可能会发生变化。

## 注意复杂性和可读性

gas 优化通常会使代码变得更难读和更复杂。一个好的工程师必须在主观上权衡哪些优化是值得的，哪些不是。

## 这里无法对每个主题进行全面处理

我们无法详细解释每个优化，也没有必要这样做，因为有其它在线资源可供参考。例如，对于 L2 和状态通道的完整或大部分处理将超出范围，而且有其它在线资源可以详细学习这些主题。

本教程的目的是提供最全面的技巧列表。如果某个技巧感觉陌生，可以作为进一步自学的提示。如果标题看起来是你已经了解的技巧，可以简单浏览该部分。

## 我们不讨论特定应用的技巧

有种高效节省 gas 的方法可以确定一个数是否为质数，但这种需求非常罕见，将笔墨用于此将降低本文的价值。同样，在我们的[Tornado Cash 教程](https://www.rareskills.io/post/how-does-tornado-cash-work)中，我们提出了代码库可以有更高效的方式，但在这里包含这种处理对读者没有好处，因为它过于特定于应用程序。

---